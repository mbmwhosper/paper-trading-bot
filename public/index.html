<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Paper Trader">
    <meta name="theme-color" content="#0a0a0f">
    <title>Paper Trading Bot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-card: #1a1a25; --accent-green: #00d4aa; --accent-red: #ff4757; --text-primary: #ffffff; --text-secondary: #a1a1b5; --text-muted: #6b6b7b; --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); }
        html { background: var(--bg-primary); }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; min-height: 100dvh; padding: var(--safe-top) 0 var(--safe-bottom); -webkit-font-smoothing: antialiased; }
        .container { max-width: 800px; margin: 0 auto; padding: 16px; }
        @media (min-width: 768px) { .container { padding: 24px; max-width: 1200px; } }
        header { padding: 20px 0 24px; border-bottom: 1px solid rgba(255,255,255,0.06); margin-bottom: 24px; }
        .header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        h1 { font-size: 1.75rem; font-weight: 700; letter-spacing: -0.02em; }
        @media (min-width: 768px) { h1 { font-size: 2rem; } }
        .subtitle { color: var(--text-secondary); font-size: 0.9375rem; }
        .connection-status { display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 0.8125rem; font-weight: 600; background: rgba(255,71,87,0.1); color: var(--accent-red); }
        .connection-status.connected { background: rgba(0,212,170,0.1); color: var(--accent-green); }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
        .connection-status.connected .status-dot { animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }
        .stats-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; margin-bottom: 20px; }
        @media (min-width: 768px) { .stats-grid { grid-template-columns: repeat(4,1fr); gap: 16px; } }
        .stat-card { background: var(--bg-card); border-radius: 16px; padding: 16px; border: 1px solid rgba(255,255,255,0.04); }
        .stat-card h3 { color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600; }
        .stat-card .value { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em; }
        .stat-card .value.positive { color: var(--accent-green); }
        .stat-card .value.negative { color: var(--accent-red); }
        .stat-card .sub-value { font-size: 0.8125rem; color: var(--text-muted); margin-top: 4px; }
        .card { background: var(--bg-card); border-radius: 16px; padding: 16px; border: 1px solid rgba(255,255,255,0.04); margin-bottom: 16px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .card h3 { color: var(--text-primary); font-size: 1.0625rem; font-weight: 600; }
        .badge { padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; background: var(--bg-secondary); color: var(--text-secondary); }
        .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; margin: 0 -16px; padding: 0 16px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9375rem; }
        th, td { text-align: left; padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.04); }
        th { color: var(--text-secondary); font-weight: 600; font-size: 0.8125rem; text-transform: uppercase; }
        .symbol { font-weight: 700; font-size: 1rem; }
        .pnl { font-weight: 600; }
        .pnl.positive { color: var(--accent-green); }
        .pnl.negative { color: var(--accent-red); }
        .trade-badge { display: inline-flex; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .trade-badge.buy { background: rgba(0,212,170,0.12); color: var(--accent-green); }
        .trade-badge.sell { background: rgba(255,71,87,0.12); color: var(--accent-red); }
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-muted); }
        .empty-state-icon { font-size: 3rem; margin-bottom: 12px; opacity: 0.5; }
        .trading-status { display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 16px; }
        .status-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .status-icon.active { background: rgba(0,212,170,0.15); }
        .status-icon.paused { background: rgba(255,193,7,0.15); }
        .status-info h4 { font-size: 1rem; margin-bottom: 2px; }
        .status-info p { font-size: 0.8125rem; color: var(--text-secondary); }
        .refresh { position: fixed; bottom: calc(20px + var(--safe-bottom)); right: 20px; width: 56px; height: 56px; border-radius: 50%; background: var(--accent-green); border: none; color: var(--bg-primary); font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 20px rgba(0,212,170,0.4); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .refresh.spinning { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .footer { text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.8125rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>üìà Paper Trader</h1>
                <div class="connection-status" id="connection-status"><span class="status-dot"></span><span id="connection-text">Connecting</span></div>
            </div>
            <p class="subtitle">Alpaca Paper Account ‚Ä¢ Momentum Strategy</p>
        </header>
        
        <div class="trading-status" id="trading-status-card">
            <div class="status-icon paused" id="status-icon">‚è∏Ô∏è</div>
            <div class="status-info">
                <h4 id="status-title">Market Closed</h4>
                <p id="status-desc">Trading resumes at 9:30 AM ET</p>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card"><h3>Account Equity</h3><div class="value" id="equity">--</div><div class="sub-value" id="buying-power">Buying Power: --</div></div>
            <div class="stat-card"><h3>Today's P&L</h3><div class="value" id="pnl">--</div><div class="sub-value" id="trade-count">0 trades</div></div>
            <div class="stat-card"><h3>Positions</h3><div class="value" id="positions">--</div><div class="sub-value" id="pos-value">Value: --</div></div>
            <div class="stat-card"><h3>Trades Left</h3><div class="value" id="trades-remaining">--</div><div class="sub-value">Max 5 per day</div></div>
        </div>
        
        <div class="card">
            <div class="card-header"><h3>Current Positions</h3><span class="badge" id="pos-badge">0</span></div>
            <div class="table-container">
                <table id="positions-table">
                    <thead><tr><th>Symbol</th><th>Qty</th><th>Value</th><th>P&L</th></tr></thead>
                    <tbody id="positions-body"><tr><td colspan="4" class="empty-state"><div class="empty-state-icon">üì≠</div>No open positions</td></tr></tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header"><h3>Today's Trades</h3><span class="badge" id="trades-badge">0</span></div>
            <div class="table-container">
                <table id="trades-table">
                    <thead><tr><th>Time</th><th>Action</th><th>Symbol</th><th>P&L</th></tr></thead>
                    <tbody id="trades-body"><tr><td colspan="4" class="empty-state"><div class="empty-state-icon">üìä</div>No trades today</td></tr></tbody>
                </table>
            </div>
        </div>
        
        <div class="footer"><p id="last-updated">Last updated: Never</p></div>
    </div>
    <button class="refresh" onclick="refresh()">‚Üª</button>
    <script>
        async function refresh() {
            const btn = document.querySelector('.refresh');
            btn.classList.add('spinning');
            try {
                const [accountRes, positionsRes, statsRes] = await Promise.all([fetch('/api/account'), fetch('/api/positions'), fetch('/api/stats')]);
                if (!accountRes.ok) throw new Error('API Error');
                const account = await accountRes.json();
                const positions = await positionsRes.json();
                const stats = await statsRes.json();
                document.getElementById('connection-status').className = 'connection-status connected';
                document.getElementById('connection-text').textContent = 'Connected';
                document.getElementById('equity').textContent = '$' + account.equity.toFixed(2);
                document.getElementById('buying-power').textContent = 'Buying Power: $' + account.buying_power.toFixed(2);
                const pnlEl = document.getElementById('pnl');
                pnlEl.textContent = '$' + stats.profitLoss.toFixed(2);
                pnlEl.className = 'value ' + (stats.profitLoss >= 0 ? 'positive' : 'negative');
                document.getElementById('trade-count').textContent = stats.trades.length + ' trades';
                document.getElementById('positions').textContent = positions.length;
                const posValue = positions.reduce((sum,p) => sum + p.market_value, 0);
                document.getElementById('pos-value').textContent = 'Value: $' + posValue.toFixed(2);
                document.getElementById('pos-badge').textContent = positions.length;
                document.getElementById('trades-remaining').textContent = stats.tradesRemaining;
                document.getElementById('trades-badge').textContent = stats.trades.length;
                const statusIcon = document.getElementById('status-icon');
                const statusTitle = document.getElementById('status-title');
                const statusDesc = document.getElementById('status-desc');
                if (stats.canTrade) { statusIcon.className = 'status-icon active'; statusIcon.textContent = '‚ñ∂Ô∏è'; statusTitle.textContent = 'Active Trading'; statusDesc.textContent = 'Scanning for momentum'; }
                else if (positions.length > 0) { statusIcon.className = 'status-icon active'; statusIcon.textContent = 'üìä'; statusTitle.textContent = 'Managing Positions'; statusDesc.textContent = 'Monitoring ' + positions.length + ' position' + (positions.length > 1 ? 's' : ''); }
                else { statusIcon.className = 'status-icon paused'; statusIcon.textContent = '‚è∏Ô∏è'; statusTitle.textContent = 'Waiting'; statusDesc.textContent = 'Market conditions'; }
                const posBody = document.getElementById('positions-body');
                posBody.innerHTML = positions.length > 0 ? positions.map(p => '<tr><td class="symbol">' + p.symbol + '</td><td>' + p.qty + '</td><td>$' + p.market_value.toFixed(2) + '</td><td class="pnl ' + (p.unrealized_pl >= 0 ? 'positive' : 'negative') + '">' + (p.unrealized_pl >= 0 ? '+' : '') + '$' + p.unrealized_pl.toFixed(2) + '</td></tr>').join('') : '<tr><td colspan="4" class="empty-state"><div class="empty-state-icon">üì≠</div>No open positions</td></tr>';
                const tradeBody = document.getElementById('trades-body');
                const trades = stats.trades || [];
                tradeBody.innerHTML = trades.length > 0 ? trades.slice().reverse().map(t => '<tr><td>' + new Date(t.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + '</td><td><span class="trade-badge ' + t.action.toLowerCase() + '">' + t.action + '</span></td><td class="symbol">' + t.symbol + '</td><td class="pnl ' + ((t.pnl || 0) >= 0 ? 'positive' : 'negative') + '">' + (t.pnl ? ((t.pnl >= 0 ? '+' : '') + '$' + t.pnl.toFixed(2)) : '--') + '</td></tr>').join('') : '<tr><td colspan="4" class="empty-state"><div class="empty-state-icon">üìä</div>No trades today</td></tr>';
                document.getElementById('last-updated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
            } catch (e) {
                document.getElementById('connection-status').className = 'connection-status';
                document.getElementById('connection-text').textContent = 'Disconnected';
            }
            btn.classList.remove('spinning');
        }
        refresh();
        setInterval(refresh, 10000);
    </script>
</body>
</html>
